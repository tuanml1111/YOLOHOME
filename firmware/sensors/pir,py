"""
PIR Motion Sensor Driver
"""
from machine import Pin
import time

class PIRSensor:
    """
    PIR Motion Sensor
    """
    def __init__(self, pin=13, active_high=True):
        """Initialize sensor"""
        self.pir = Pin(pin, Pin.IN)
        self.active_high = active_high
        self.last_motion = False
        self.debounce_time = 0
    
    def motion_detected(self):
        """Read current motion state with debouncing"""
        current_time = time.ticks_ms()
        
        # Skip reading if within debounce period
        if time.ticks_diff(current_time, self.debounce_time) < 2000:
            return self.last_motion
        
        # Read current state
        reading = self.pir.value() if self.active_high else not self.pir.value()
        
        if reading != self.last_motion:
            self.debounce_time = current_time
            self.last_motion = reading
        
        return self.last_motion
    
    def set_callback(self, callback):
        """Set callback for motion detection (interrupt-based)"""
        trigger = Pin.IRQ_RISING if self.active_high else Pin.IRQ_FALLING
        self.pir.irq(trigger=trigger, handler=callback)